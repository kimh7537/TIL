#Redis

---
---
## ✏️ `Lettuce`

![alt text](image/image-2.png)

- `setnx` 명령어를 활용하여 분산락 구현
- `spin lock`방식: 락을 획득하려는 스레드가 락을 획득할 수 있는지 반복적으로 확인하면서 락획득 시도
- Thread-1이 key가 1인 데이터가 없어서 성공
- Thread-2는 key가 1인 데이터가 있어서 실패

**장점**
- 구현이 간단함
- spring data redis를 이용하면 lettuce가 기본 라이브러리이기 때문에 별도의 라이브러리를 사용하지 않아도 됨

**단점**
- `spin lock`방식이기 때문에 동시에 많은 스레드가 lock획득 대기 상태라면 redis에 부하가 갈 수 있음


---
---
## ✏️ `Redisson`

![alt text](image/image-3.png)

- `pub-sub` 기반으로 Lock구현 제공
- 채널을 하나 만들고 락을 점유중인 쓰레드가 락을 획득하려고 대기중인 스레드에게 해제를 알려주면 안내를 받은 스레드가 락 획득을 시도
- `Lettuce`와 다르게 별도의 retry로직이 필요없음


**장점**
- 락 획득 재시도를 기본으로 제공함
- `pub-sub`방식으로 구현이 되어있어 `lettuce`와 비교했을 때 `redis`에 부하가 덜 감

**단점**
- 별도의 라이브러리를 사용해야함
- `lock`을 라이브러리 차원에서 제공해주기 때문에 사용법을 공부해야함

**실무**
- 재시도가 필요하지 않은 lock은 `lettuce` 활용
- 재시도가 필요한 경우 `reddison` 활용


---
---
## ✏️ `Mysql` vs `Redis`

### ✔️ `Mysql`

- 별도의 비용 없이 사용 가능
- 어느정도의 트래픽까지는 문제없이 활용 가능
- Redis보다 성능이 좋지는 않음


### ✔️ `Redis`

- 활용중인 Redis가 없다면 별도의 구축비용과 인프라 관리비용이 발생함
- MySql보다 성능이 좋음


