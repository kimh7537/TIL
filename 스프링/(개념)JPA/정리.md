
## ✏️ 3. 연관관계 매핑1
### ✔️ `단방향 연관관계 매핑`
```java
//Member
@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "TEAM_ID")
private Team team;
```
```java
//팀 저장
Team team = new Team();
team.setName("TeamA");
em.persist(team);
//회원 저장
Member member = new Member();
member.setUsername("member1");
member.setTeam(team); //단방향 연관관계 설정, 참조 저장
em.persist(member);

em.flush(); //db로 정보 바로 보내기
em.clear(); //영속성 컨텍스트 내용 지우기
```
```java
//flush/clear진행 후
//조회
Member findMember = em.find(Member.class, member.getId());  

//참조를 사용해서 연관관계 조회
Team findTeam = findMember.getTeam();
System.out.println("findTeam.getName() = " + findTeam.getName());
```
```
- Lazy아닐때 이런 쿼리 날아감
select member_id, team_id(member), username, team_id(team), name
from Member
left outer join Team
on team_id(member) = team_id(team)
where member_id = ?
```
<span style="color: #2D3748; background-color: #fff5b1;"> 
- `member`를 DB에서 찾을 때, `Member`객체가 `Team`을 가지고 있으므로 `join` 사용한 `SELECT`쿼리가 DB로 들어감<br>
- member, team 2개 들고옴<br>
- LAZY라면 쿼리 분리하기<br>
</span>

```
- Lazy 일때 쿼리
select member_id, team_id, username
from Member
where member_id = ?

select team_id, name
from Team
where team_id = ?
```


### ✔️ `양방향 연관관계 매핑`

```java
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

Member member1 = new Member();
member1.setUsername("member2");
member1.setTeam(team);
em.persist(member1);

//team.getMembers().add(member);

em.flush();
em.clear();


Team findTeam = em.find(Team.class, team.getId()); //쿼리 1개(select team_id, name ...)

System.out.println("hello");
List<Member> members = findTeam.getMembers();
System.out.println("good");
for(Member m : members){                       
    System.out.println("m.getUsername() = " + m.getUsername());
}
```



```
//Lazy, Eager 쿼리 같음
Hibernate: 
    select
        t1_0.team_id,
        t1_0.name 
    from
        Team t1_0 
    where
        t1_0.team_id=?
hello
good
Hibernate: 
    select
        m1_0.team_id,
        m1_0.member_id,
        m1_0.username 
    from
        Member m1_0 
    where
        m1_0.team_id=?
m.getUsername() = member1
m.getUsername() = member2
```
<span style="color: #2D3748; background-color: #fff5b1;">
JPA가 List 값을 실사용할때(m.getUsername()) 지연로딩으로 값을 가지고오는 기능을 함 
</span>

